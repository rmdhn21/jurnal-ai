<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Jurnal AI - Life Organizer</title>
    <meta name="description" content="Aplikasi journaling dengan AI yang membantu Anda berpikir lebih jernih">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#f59e0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Jurnal AI">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- iOS Safe Area Styling -->
    <style>
        /* iOS Safe Area Support */
        body {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        /* iOS Standalone Mode Status Bar Padding */
        @media all and (display-mode: standalone) {
            .header {
                padding-top: calc(var(--spacing-md) + env(safe-area-inset-top));
            }
        }
    </style>
</head>

<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">âœ¨</div>
            <h1>Jurnal AI</h1>
            <p class="login-subtitle">Life Organizer</p>

            <div id="login-form" class="login-form">
                <input type="text" id="login-username" class="input" placeholder="Username">
                <input type="password" id="login-password" class="input" placeholder="Password">
                <button id="login-btn" class="btn btn-primary btn-full">ğŸ” Login Lokal</button>
                <button id="show-register-btn" class="btn btn-secondary btn-full">ğŸ“ Buat Akun Baru</button>

                <div class="divider">
                    <span>atau</span>
                </div>

                <button id="cloud-login-btn" class="btn btn-cloud btn-full">â˜ï¸ Login Cloud (Sync)</button>
            </div>

            <div id="register-form" class="login-form hidden">
                <input type="text" id="register-username" class="input" placeholder="Username baru">
                <input type="password" id="register-password" class="input" placeholder="Password">
                <input type="password" id="register-password-confirm" class="input" placeholder="Konfirmasi Password">
                <button id="register-btn" class="btn btn-primary btn-full">âœ… Daftar</button>
                <button id="show-login-btn" class="btn btn-secondary btn-full">â† Kembali ke Login</button>
            </div>

            <!-- Cloud Login Form -->
            <div id="cloud-login-form" class="login-form hidden">
                <p class="cloud-login-text">
                    Login dengan email untuk sync data antar device
                </p>
                <input type="email" id="cloud-email" class="input" placeholder="Email">
                <input type="password" id="cloud-password" class="input" placeholder="Password">
                <button id="cloud-signin-btn" class="btn btn-cloud btn-full">â˜ï¸ Sign In</button>
                <button id="cloud-signup-btn" class="btn btn-secondary btn-full">ğŸ“ Sign Up</button>
                <button id="back-to-local-btn" class="btn btn-secondary btn-full">â† Login Lokal</button>
            </div>
        </div>
    </div>

    <div class="app hidden" id="main-app">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">âœ¨ Jurnal AI</h1>

            <!-- Global Search -->
            <div class="global-search">
                <input type="text" id="global-search-input" placeholder="ğŸ” Cari jurnal, task, goals..."
                    class="search-input">
                <div id="search-results" class="search-results hidden"></div>
            </div>

            <!-- Sync Status Indicator -->
            <div id="sync-status-indicator" class="sync-indicator" title="Status Sync">
                <span id="sync-icon">âš«</span>
                <span id="sync-text">Offline</span>
            </div>

            <div class="header-actions">
                <button id="theme-toggle-btn" class="icon-btn" title="Ganti Tema">ğŸŒ™</button>
                <button id="logout-btn" class="icon-btn" title="Logout">ğŸšª</button>
                <button id="settings-btn" class="icon-btn" title="Settings">âš™ï¸</button>
            </div>
        </header>

        <!-- Navigation (6 Tabs) -->
        <nav class="nav">
            <button class="nav-btn active" data-screen="dashboard">ğŸ“Š Dashboard</button>
            <button class="nav-btn" data-screen="journal">ğŸ“ Jurnal</button>
            <button class="nav-btn" data-screen="planner">ğŸ“‹ Planner</button>
            <button class="nav-btn" data-screen="goals">ğŸ¯ Goals</button>
            <button class="nav-btn" data-screen="finance">ğŸ’° Keuangan</button>
            <button class="nav-btn" data-screen="habits">âœ… Habits</button>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- Screen 0: Dashboard -->
            <section id="dashboard-screen" class="screen active">
                <!-- Overview Cards -->
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="dashboard-icon">ğŸ“</div>
                        <div class="dashboard-stat" id="stat-journals">0</div>
                        <div class="dashboard-label">Total Jurnal</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-icon">âœ…</div>
                        <div class="dashboard-stat" id="stat-tasks">0/0</div>
                        <div class="dashboard-label">Task Selesai</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-icon">ğŸ’°</div>
                        <div class="dashboard-stat" id="stat-balance">Rp 0</div>
                        <div class="dashboard-label">Saldo</div>
                    </div>
                    <div class="dashboard-card" id="streak-card">
                        <div class="dashboard-icon">ğŸ”¥</div>
                        <div class="dashboard-stat" id="current-streak">0</div>
                        <div class="dashboard-label">Best Streak</div>
                    </div>

                    <div class="dashboard-card" id="prayer-card">
                        <div class="prayer-card-header">
                            <div class="prayer-card-left">
                                <span class="prayer-card-icon">ğŸ•Œ</span>
                                <div>
                                    <div class="prayer-card-location" id="prayer-location">Jakarta</div>
                                    <div class="prayer-card-name" id="next-prayer-name">Subuh</div>
                                </div>
                            </div>
                            <div class="prayer-card-right">
                                <div class="prayer-card-time" id="next-prayer-time">--:--</div>
                                <div class="prayer-card-countdown" id="next-prayer-countdown">-00:00:00</div>
                            </div>
                        </div>
                        <div class="prayer-list-mini" id="prayer-list-mini">
                            <!-- Injected by JS -->
                            <div>Subuh<br>04:30</div>
                            <div>Dzuhur<br>12:00</div>
                            <div>Ashar<br>15:15</div>
                            <div>Maghrib<br>18:00</div>
                            <div>Isya<br>19:15</div>
                        </div>
                    </div>
                </div>

                <!-- Global Daily Budget -->
                <div class="card mt-md" id="global-budget-card">
                    <div class="budget-card-header">
                        <h3>ğŸ“‰ Budget Harian</h3>
                        <span id="global-budget-text" class="text-muted">Rp 0 / Rp 0</span>
                    </div>
                    <div class="progress-bar">
                        <div id="global-budget-progress" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small class="text-muted budget-card-hint">
                        Pengeluaran hari ini dari semua wallet.
                    </small>
                </div>

                <!-- Today's Reminder -->
                <div class="card">
                    <h3>ğŸ”” Reminder Hari Ini</h3>
                    <div id="today-reminders" class="reminder-list">
                        <p class="text-muted">Tidak ada reminder hari ini</p>
                    </div>
                </div>

                <!-- Upcoming Schedule -->
                <div class="card">
                    <h3>ğŸ“… Jadwal Mendatang</h3>
                    <div id="upcoming-schedules" class="reminder-list">
                        <p class="text-muted">Tidak ada jadwal</p>
                    </div>
                </div>

                <!-- Mood History Chart -->
                <div class="card">
                    <h3>ğŸ­ Mood Minggu Ini</h3>
                    <div class="mood-chart-container">
                        <canvas id="mood-chart" height="150"></canvas>
                    </div>
                </div>

                <!-- Mood Calendar Section -->
                <div class="card calendar-card">
                    <div class="calendar-header">
                        <button id="prev-month-btn" class="icon-btn">â—€</button>
                        <h3 id="calendar-month-year"></h3>
                        <button id="next-month-btn" class="icon-btn">â–¶</button>
                    </div>
                    <div class="calendar-days-header">
                        <span>Sen</span><span>Sel</span><span>Rab</span><span>Kam</span><span>Jum</span><span>Sab</span><span>Min</span>
                    </div>
                    <div id="mood-calendar-grid" class="calendar-grid">
                        <!-- Days generated by JS -->
                    </div>
                </div>

                <!-- Quick AI Insight -->
                <div class="card">
                    <h3>ğŸ§  Quick AI Insight</h3>
                    <div id="quick-insight" class="insight-box">
                        <p class="text-muted">Klik tombol di bawah untuk insight harian</p>
                    </div>
                    <button id="get-daily-insight-btn" class="btn btn-ai btn-full">âœ¨ Dapatkan Insight Harian</button>
                </div>
            </section>

            <!-- Screen 1: Journal Write -->
            <section id="journal-screen" class="screen">
                <div class="card journal-card">
                    <h2>Apa yang ada di pikiranmu?</h2>

                    <!-- Mood Selector -->
                    <div class="mood-selector">
                        <label class="mood-label">Bagaimana perasaanmu hari ini?</label>
                        <div class="mood-options" id="mood-options">
                            <button type="button" class="mood-btn" data-mood="great" title="Sangat Baik">ğŸ˜„</button>
                            <button type="button" class="mood-btn" data-mood="good" title="Baik">ğŸ™‚</button>
                            <button type="button" class="mood-btn" data-mood="neutral" title="Biasa">ğŸ˜</button>
                            <button type="button" class="mood-btn" data-mood="bad" title="Kurang Baik">ğŸ˜”</button>
                            <button type="button" class="mood-btn" data-mood="terrible" title="Buruk">ğŸ˜¢</button>
                        </div>
                    </div>

                    <!-- Tag Input -->
                    <div class="tag-input-container">
                        <div id="journal-tags" class="tag-list"></div>
                        <input type="text" id="tag-input" class="tag-input" placeholder="+ Tag (Tekan Enter)">
                    </div>

                    <textarea id="journal-input" class="journal-textarea"
                        placeholder="Tulis apa saja yang kamu pikirkan atau rasakan hari ini..."></textarea>
                    <div class="journal-actions">
                        <button id="mic-btn" class="icon-btn" title="Rekam Suara">ğŸ¤</button>
                        <span id="recording-status" class="text-muted hidden recording-status">Mendengarkan...</span>
                        <button id="template-btn" class="icon-btn template-btn-space"
                            title="Template Muhasabah">ğŸ“‹</button>
                        <span id="char-count" class="char-count">0 karakter</span>
                        <button id="ask-ai-btn" class="btn btn-primary">
                            <span class="btn-icon">ğŸ¤–</span>
                            Minta Respon AI
                        </button>
                    </div>
                </div>

                <!-- AI Response Section (hidden by default) -->
                <div id="ai-response-section" class="ai-response-section hidden">
                    <div class="card response-card">
                        <div class="response-header">
                            <h3>ğŸ’¬ Respon AI</h3>
                            <button id="close-response" class="icon-btn">âœ•</button>
                        </div>

                        <!-- Validation -->
                        <div class="response-block validation">
                            <div class="response-label">ğŸ’ Validasi</div>
                            <p id="ai-validation"></p>
                        </div>

                        <!-- Summary -->
                        <div class="response-block summary">
                            <div class="response-label">ğŸ“Œ Ringkasan</div>
                            <ul id="ai-summary"></ul>
                        </div>

                        <!-- Suggestions -->
                        <div class="response-block suggestions">
                            <div class="response-label">ğŸ’¡ Saran</div>
                            <div id="ai-suggestions"></div>
                        </div>

                        <!-- Closing Question -->
                        <div class="response-block closing">
                            <div class="response-label">â“ Pertanyaan</div>
                            <p id="ai-closing"></p>
                        </div>

                        <!-- Save Journal Button -->
                        <div class="response-actions">
                            <button id="save-journal-btn" class="btn btn-secondary">
                                ğŸ’¾ Simpan Jurnal
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="ai-loading" class="loading-overlay hidden">
                    <div class="loading-spinner"></div>
                    <p>AI sedang berpikir...</p>
                </div>

                <!-- Journal History -->
                <div class="card history-card">
                    <h3>ğŸ“š Jurnal Terbaru</h3>
                    <div class="journal-filter-bar">
                        <div class="filter-label">Filter:</div>
                        <div id="active-filters" class="active-filters"></div>
                        <select id="mood-filter" class="filter-select">
                            <option value="all">Semua Mood</option>
                            <option value="great">ğŸ˜„ Sangat Baik</option>
                            <option value="good">ğŸ™‚ Baik</option>
                            <option value="neutral">ğŸ˜ Biasa</option>
                            <option value="bad">ğŸ˜” Kurang Baik</option>
                            <option value="terrible">ğŸ˜¢ Buruk</option>
                        </select>
                        <select id="tag-filter" class="filter-select">
                            <option value="all">Semua Tags</option>
                        </select>
                    </div>
                    <div id="journal-history"></div>
                </div>
            </section>

            <!-- Screen 2: Planner -->
            <section id="planner-screen" class="screen">
                <!-- Pomodoro Timer -->
                <div class="card pomodoro-card">
                    <div class="pomodoro-header">
                        <h2>â±ï¸ Pomodoro Timer</h2>
                        <span id="pomodoro-session" class="session-badge">Session 1</span>
                    </div>

                    <!-- Mode Selector -->
                    <div class="pomodoro-modes">
                        <button class="btn btn-small btn-primary mode-btn" data-mode="focus"
                            data-time="25">Fokus</button>
                        <button class="btn btn-small btn-secondary mode-btn" data-mode="barakah" data-time="90">ğŸŒ…
                            Barakah</button>
                        <button class="btn btn-small btn-secondary mode-btn" data-mode="qailulah" data-time="20">ğŸ’¤
                            Qailulah</button>
                    </div>
                    <div class="pomodoro-display">
                        <div class="timer-circle">
                            <span id="timer-minutes">25</span>
                            <span class="timer-separator">:</span>
                            <span id="timer-seconds">00</span>
                        </div>
                        <div id="timer-label" class="timer-label">Fokus</div>
                    </div>
                    <div class="pomodoro-controls">
                        <button id="timer-start" class="btn btn-primary">â–¶ï¸ Mulai</button>
                        <button id="timer-pause" class="btn btn-secondary" disabled>â¸ï¸ Pause</button>
                        <button id="timer-reset" class="btn btn-secondary">ğŸ”„ Reset</button>
                    </div>
                    <div class="pomodoro-stats">
                        <span>ğŸ… <span id="pomodoro-count">0</span> pomodoro hari ini</span>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ“‹ To-Do</h2>
                    <div class="add-form">
                        <input type="text" id="new-todo-input" placeholder="Tambah task baru..." class="input">
                        <button id="add-todo-btn" class="btn btn-primary">+ Tambah</button>
                    </div>
                    <div id="todo-list" class="task-list"></div>
                </div>

                <div class="card">
                    <h2>ğŸ“… Jadwal</h2>
                    <div class="add-form">
                        <input type="text" id="new-schedule-title" placeholder="Nama kegiatan..." class="input">
                        <div class="form-row">
                            <input type="datetime-local" id="new-schedule-datetime" class="input">
                            <select id="new-schedule-priority" class="input">
                                <option value="allah">ğŸ”´ Allah (Ibadah)</option>
                                <option value="self">ğŸŸ¢ Diri (Istirahat/Belajar)</option>
                                <option value="others">ğŸ”µ Umat (Kerja/Sosial)</option>
                            </select>
                        </div>
                        <button id="add-schedule-btn" class="btn btn-primary">+ Tambah</button>
                    </div>
                    <div id="schedule-list" class="schedule-list"></div>
                </div>

                <!-- AI Analysis Button -->
                <button id="analyze-planner-btn" class="btn btn-ai btn-full">ğŸ§  Analisis AI - Produktivitas</button>
            </section>

            <!-- Screen 3.5: Goals -->
            <section id="goals-screen" class="screen">
                <!-- Goal Stats -->
                <div class="dashboard-grid goals-grid">
                    <div class="dashboard-card">
                        <div class="dashboard-icon">ğŸ¯</div>
                        <div class="dashboard-stat" id="stat-goals-active">0</div>
                        <div class="dashboard-label">Goals Aktif</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-icon">âœ…</div>
                        <div class="dashboard-stat" id="stat-goals-completed">0</div>
                        <div class="dashboard-label">Tercapai</div>
                    </div>
                </div>

                <!-- Add New Goal -->
                <div class="card">
                    <h2>ğŸ¯ Tambah Goal Baru</h2>
                    <div class="goal-form">
                        <input type="text" id="goal-title" placeholder="Judul goal (misal: Lari 5km)" class="input">
                        <div class="form-row">
                            <select id="goal-type" class="input">
                                <option value="habit">ğŸ”„ Berbasis Habit</option>
                                <option value="count">ğŸ”¢ Target Angka</option>
                                <option value="deadline">ğŸ“… Target Deadline</option>
                            </select>
                        </div>
                        <div class="form-row" id="goal-target-row">
                            <input type="number" id="goal-target" placeholder="Target (misal: 30)" class="input">
                            <input type="text" id="goal-unit" placeholder="Satuan (misal: hari, km)" class="input">
                        </div>
                        <input type="date" id="goal-deadline" class="input">
                        <textarea id="goal-notes" class="input" placeholder="Catatan (opsional)" rows="2"></textarea>
                        <button id="add-goal-btn" class="btn btn-primary">+ Tambah Goal</button>
                    </div>
                </div>

                <!-- Active Goals -->
                <div class="card">
                    <h3>ğŸš€ Goals Aktif</h3>
                    <div id="active-goals-list" class="goals-list"></div>
                </div>

                <!-- Completed Goals -->
                <div class="card">
                    <h3>ğŸ† Goals Tercapai</h3>
                    <div id="completed-goals-list" class="goals-list"></div>
                </div>
            </section>

            <!-- Screen 4: Finance -->
            <section id="finance-screen" class="screen">
                <!-- Wallet Summary -->
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ’³ Dompet Saya</h3>
                        <button id="manage-wallets-btn" class="btn btn-small btn-secondary">âš™ï¸ Kelola</button>
                    </div>
                    <div id="wallet-list-summary" class="wallet-list-summary">
                        <!-- Wallets injected here -->
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="summary-row">
                    <div class="summary-card income">
                        <span class="summary-label">Pemasukan</span>
                        <span id="total-income" class="summary-value">Rp 0</span>
                    </div>
                    <div class="summary-card expense">
                        <span class="summary-label">Pengeluaran</span>
                        <span id="total-expense" class="summary-value">Rp 0</span>
                    </div>
                    <div class="summary-card balance">
                        <span class="summary-label">Saldo Total</span>
                        <span id="total-balance" class="summary-value">Rp 0</span>
                    </div>
                </div>

                <!-- Chart -->
                <div class="card">
                    <h3>ğŸ“Š Grafik Bulanan</h3>
                    <div class="chart-container">
                        <canvas id="finance-chart"></canvas>
                    </div>
                </div>

                <!-- Global Budget Card -->
                <div id="global-budget-card" class="card hidden">
                    <div class="card-header">
                        <h3>ğŸ“‰ Budget Harian Global</h3>
                        <span id="global-budget-text" class="summary-value budget-font-sm">Rp 0 / Rp 0</span>
                    </div>
                    <div class="budget-progress-container budget-progress-mt">
                        <div id="global-budget-progress" class="budget-progress-bar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Budget Card -->
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ“‰ Budgeting</h3>
                        <button id="manage-budget-btn" class="btn btn-small btn-secondary">âš™ï¸ Atur</button>
                    </div>
                    <div id="budget-list-summary" class="budget-list">
                        <!-- Budgets injected here -->
                    </div>
                </div>

                <!-- Add Transaction -->
                <div class="card">
                    <h2>ğŸ’° Tambah Transaksi</h2>
                    <div class="transaction-form">
                        <div class="form-row">
                            <select id="transaction-type" class="input">
                                <option value="income">ğŸ’µ Pemasukan</option>
                                <option value="expense">ğŸ’¸ Pengeluaran</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Wallet</label>
                            <select id="transaction-wallet" class="input">
                                <!-- Options injected by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="toggle-label">
                                <input type="checkbox" id="is-recurring-transaction">
                                <span>ğŸ”„ Transaksi Rutin Bulanan?</span>
                            </label>
                        </div>
                        <div id="recurring-date-group" class="form-group hidden">
                            <label>Tanggal Rutin (Setiap Bulan)</label>
                            <input type="number" id="recurring-date" class="input" min="1" max="31"
                                placeholder="Tanggal 1-31">
                        </div>
                        <div class="form-row">
                            <input type="number" id="transaction-amount" placeholder="Jumlah" class="input">
                            <input type="date" id="transaction-date" class="input">
                        </div>
                        <input type="text" id="transaction-category" placeholder="Kategori (misal: Gaji, Makan)"
                            class="input">

                        <input type="text" id="transaction-desc" placeholder="Deskripsi (opsional)" class="input">
                        <button id="add-transaction-btn" class="btn btn-primary">+ Tambah Transaksi</button>
                    </div>
                </div>

                <!-- Transaction List -->
                <div class="card">
                    <h3>ğŸ“œ Riwayat Transaksi</h3>
                    <div id="transaction-list" class="transaction-list"></div>
                </div>

                <!-- AI Analysis Button -->
                <button id="analyze-finance-btn" class="btn btn-ai btn-full">ğŸ§  Analisis AI - Keuangan</button>
            </section>

            <!-- Screen 4: Habits -->
            <section id="habits-screen" class="screen">
                <!-- Habit Progress Chart -->
                <div class="card">
                    <h3>ğŸ“ˆ Progress Mingguan</h3>
                    <div class="chart-container">
                        <canvas id="habits-chart"></canvas>
                    </div>
                </div>

                <!-- Add Habit -->
                <div class="card">
                    <h2>âœ… Tambah Habit</h2>
                    <div class="add-form">
                        <input type="text" id="new-habit-input" placeholder="Nama habit baru..." class="input">
                        <select id="habit-frequency" class="input">
                            <option value="daily">ğŸ“… Harian</option>
                            <option value="weekly">ğŸ“† Mingguan</option>
                            <option value="custom">ğŸ”„ Custom</option>
                        </select>
                        <div id="habit-freq-days" class="habit-freq-days hidden">
                            <label><input type="checkbox" value="1"> Sen</label>
                            <label><input type="checkbox" value="2"> Sel</label>
                            <label><input type="checkbox" value="3"> Rab</label>
                            <label><input type="checkbox" value="4"> Kam</label>
                            <label><input type="checkbox" value="5"> Jum</label>
                            <label><input type="checkbox" value="6"> Sab</label>
                            <label><input type="checkbox" value="0"> Min</label>
                        </div>
                        <div id="habit-freq-interval" class="hidden">
                            <label class="settings-hint">Setiap berapa hari?</label>
                            <input type="number" id="habit-interval-days" class="input" placeholder="3" min="2" max="30"
                                value="3">
                        </div>
                        <button id="add-habit-btn" class="btn btn-primary">+ Tambah</button>
                    </div>
                </div>

                <!-- Today's Habits -->
                <div class="card">
                    <h3>ğŸ“… Hari Ini (<span id="today-date"></span>)</h3>
                    <div id="habits-today" class="habits-list"></div>
                </div>

                <!-- All Habits -->
                <div class="card">
                    <h3>ğŸ¯ Semua Habit</h3>
                    <div id="habits-list" class="habits-list"></div>
                </div>

                <!-- AI Analysis Button -->
                <button id="analyze-habits-btn" class="btn btn-ai btn-full">ğŸ§  Analisis AI - Kebiasaan</button>
            </section>
        </main>

        <!-- AI Analysis Modal -->
        <div id="analysis-modal" class="modal hidden">
            <div class="modal-content card">
                <div class="modal-header">
                    <h3 id="analysis-title">ğŸ§  Analisis AI</h3>
                    <button id="close-analysis" class="icon-btn">âœ•</button>
                </div>
                <div id="analysis-loading" class="loading-section hidden">
                    <div class="loading-spinner"></div>
                    <p>AI sedang menganalisis...</p>
                </div>
                <div id="analysis-content" class="analysis-content"></div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content card">
                <div class="modal-header">
                    <h3>âš™ï¸ Pengaturan</h3>
                    <button id="close-settings" class="icon-btn">âœ•</button>
                </div>

                <!-- City Setting -->
                <div class="form-group">
                    <label>ğŸ“ Lokasi / Kota</label>
                    <small class="settings-hint">Untuk jadwal salat yang akurat.</small>
                    <div class="flex-row">
                        <input type="text" id="city-input" placeholder="Contoh: Jakarta, Bandung..."
                            class="input flex-1">
                        <button id="save-city-btn" class="btn btn-secondary">ğŸ’¾</button>
                    </div>
                </div>

                <hr class="settings-divider">

                <!-- API Key Section -->
                <div class="form-group">
                    <label for="api-key-input">ğŸ”‘ Gemini API Key</label>
                    <input type="password" id="api-key-input" class="input" placeholder="Masukkan API key...">
                    <small>Dapatkan gratis di <a href="https://aistudio.google.com/" target="_blank">Google AI
                            Studio</a></small>
                    <div class="api-key-warning">
                        <span class="warn-icon">âš ï¸</span>
                        <span>API key disimpan di browser (localStorage). Jangan gunakan di perangkat publik. Untuk
                            keamanan maksimal, gunakan server proxy.</span>
                    </div>
                </div>
                <button id="save-settings-btn" class="btn btn-primary">ğŸ’¾ Simpan API Key</button>

                <!-- App Lock Section -->
                <div class="form-group">
                    <label>ğŸ›¡ï¸ App Lock (PIN)</label>
                    <small class="settings-hint">Kunci aplikasi saat dibuka.</small>
                    <div class="reminder-settings">
                        <label class="toggle-label">
                            <input type="checkbox" id="pin-lock-toggle">
                            <span>Aktifkan PIN Lock</span>
                        </label>
                    </div>
                    <div id="pin-setup-section" class="hidden pin-setup-mt">
                        <button id="change-pin-btn" class="btn btn-secondary btn-full">Ubah PIN</button>
                    </div>
                </div>

                <hr class="settings-divider">



                <!-- Security Section -->
                <div class="form-group">
                    <label>ğŸ”’ Enkripsi Data</label>
                    <small class="settings-hint">Enkripsi semua data dengan password. Data
                        tidak bisa dibaca tanpa password.</small>
                    <input type="password" id="encryption-password" class="input" placeholder="Password enkripsi...">
                    <div class="flex-row-sm mt-sm">
                        <button id="encrypt-data-btn" class="btn btn-secondary flex-1">ğŸ” Enkripsi</button>
                        <button id="decrypt-data-btn" class="btn btn-secondary flex-1">ğŸ”“ Dekripsi</button>
                    </div>
                    <div id="encryption-status" class="encryption-status"></div>
                </div>

                <!-- Global Finance Settings -->
                <div class="form-group">
                    <label>ğŸ’° Pengaturan Keuangan</label>
                    <small class="settings-hint">Atur batas pengeluaran harian global.</small>
                    <div class="flex-row">
                        <input type="number" id="global-daily-budget-input" placeholder="Batas Harian (Rp)"
                            class="input flex-1">
                        <button id="save-global-budget-btn" class="btn btn-secondary">ğŸ’¾</button>
                    </div>
                </div>

                <hr class="settings-divider">

                <hr class="settings-divider">

                <!-- Export Data (CSV) Section -->
                <div class="form-group">
                    <label>ğŸ“Š Export Data (Excel/CSV)</label>
                    <small class="settings-hint">Download data dalam format CSV untuk dibuka di
                        Excel.</small>
                    <div class="flex-row-wrap">
                        <button id="export-finance-csv-btn" class="btn btn-secondary flex-btn">ğŸ’° Keuangan</button>
                        <button id="export-journal-csv-btn" class="btn btn-secondary flex-btn">ğŸ“ Jurnal</button>
                        <button id="export-habits-csv-btn" class="btn btn-secondary flex-btn">ğŸ¯ Habits</button>
                    </div>
                </div>

                <!-- Backup Section -->
                <div class="form-group">
                    <label>ğŸ’¾ Backup & Restore</label>
                    <small class="settings-hint">Export data ke file JSON atau import dari
                        backup.</small>
                    <div class="flex-row-sm">
                        <button id="export-data-btn" class="btn btn-secondary flex-1">ğŸ“¤ Export Data</button>
                        <button id="import-data-btn" class="btn btn-secondary flex-1">ğŸ“¥ Import Data</button>
                    </div>
                    <input type="file" id="import-file-input" accept=".json" class="file-input-hidden">
                </div>
                <hr class="settings-divider">

                <!-- Reminder Settings -->
                <div class="form-group">
                    <label>ğŸ”” Pengaturan Reminder</label>
                    <small class="settings-hint">Aktifkan notifikasi untuk habits dan
                        jadwal.</small>
                    <div class="reminder-settings">
                        <label class="toggle-label">
                            <input type="checkbox" id="reminder-habits-toggle">
                            <span>Reminder Habits Harian</span>
                        </label>
                        <div id="habits-time-setting" class="sub-setting hidden">
                            <label>Jam reminder:</label>
                            <input type="time" id="habits-reminder-time" class="input" value="08:00">
                        </div>
                        <label class="toggle-label">
                            <input type="checkbox" id="reminder-schedule-toggle">
                            <span>Reminder Jadwal (15 menit sebelum)</span>
                        </label>
                    </div>
                    <button id="save-reminder-btn" class="btn btn-secondary btn-full mt-sm">ğŸ’¾
                        Simpan Reminder Settings</button>
                </div>

                <hr class="settings-divider">

                <!-- Danger Zone -->
                <div class="form-group">
                    <label class="danger-label">âš ï¸ Zona Bahaya</label>
                    <button id="clear-all-data-btn" class="btn btn-danger">ğŸ—‘ï¸
                        Hapus Semua Data</button>
                    <button id="delete-account-btn" class="btn btn-danger-strong">âŒ
                        Hapus Akun Cloud</button>
                    <small class="danger-hint">Hapus Akun akan menghapus akun
                        Supabase dan semua data cloud Anda.</small>
                </div>
            </div>
        </div>
        <!-- Wallet Management Modal -->
        <div id="wallet-modal" class="modal hidden">
            <div class="modal-content card">
                <div class="modal-header">
                    <h3>ğŸ’³ Kelola Dompet</h3>
                    <button id="close-wallet-modal" class="icon-btn">âœ•</button>
                </div>

                <div class="add-form">
                    <input type="text" id="new-wallet-name" placeholder="Nama Dompet (misal: Bank Jago)" class="input">
                    <input type="number" id="new-wallet-balance" placeholder="Saldo Awal" class="input" value="0">
                    <button id="add-wallet-btn" class="btn btn-primary">+ Tambah</button>
                </div>

                <div id="wallet-management-list" class="wallet-list">
                    <!-- List of wallets with delete buttons -->
                </div>
            </div>
        </div>

        <!-- Budget Management Modal -->
        <div id="budget-modal" class="modal hidden">
            <div class="modal-content card">
                <div class="modal-header">
                    <h3>ğŸ“‰ Atur Budget Bulanan</h3>
                    <button id="close-budget-modal" class="icon-btn">âœ•</button>
                </div>

                <div class="add-form">
                    <select id="new-budget-category" class="input">
                        <!-- Categories injected here -->
                    </select>
                    <input type="number" id="new-budget-limit" placeholder="Batas Budget Bulanan (Rp)" class="input">
                    <button id="add-budget-btn" class="btn btn-primary mt-sm">+ Set
                        Budget</button>
                </div>

                <div id="budget-management-list" class="budget-list mt-md">
                    <!-- List of budgets with delete buttons -->
                </div>
            </div>
        </div>
        <!-- Lock Screen Overlay -->
        <div id="app-lock-screen" class="lock-screen hidden">
            <div class="lock-content">
                <div class="lock-icon">ğŸ”’</div>
                <h2 id="lock-title">Masukkan PIN</h2>
                <div class="pin-display">
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                    <div class="pin-dot"></div>
                </div>
                <div class="pin-keypad">
                    <button class="pin-btn" data-value="1">1</button>
                    <button class="pin-btn" data-value="2">2</button>
                    <button class="pin-btn" data-value="3">3</button>
                    <button class="pin-btn" data-value="4">4</button>
                    <button class="pin-btn" data-value="5">5</button>
                    <button class="pin-btn" data-value="6">6</button>
                    <button class="pin-btn" data-value="7">7</button>
                    <button class="pin-btn" data-value="8">8</button>
                    <button class="pin-btn" data-value="9">9</button>
                    <button class="pin-btn btn-clear" data-value="clear">C</button>
                    <button class="pin-btn" data-value="0">0</button>
                    <button class="pin-btn btn-back" data-value="back">âŒ«</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts (modular) -->
    <!-- Core / Data Layer -->
    <script src="js/storage.js"></script>
    <script src="js/cloud-sync.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/encryption.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/charts.js"></script>

    <!-- UI Modules -->
    <script src="js/backup-tags.js"></script>
    <script src="js/journal-ui.js"></script>
    <script src="js/planner-ui.js"></script>
    <script src="js/pomodoro.js"></script>
    <script src="js/finance-ui.js"></script>
    <script src="js/habits-goals-ui.js"></script>
    <script src="js/navigation-settings.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/wallet-budget-ui.js"></script>

    <!-- Feature Modules -->
    <script src="js/features.js"></script>
    <script src="js/extras.js"></script>

    <!-- App Initialization (must be last) -->
    <script src="js/app-init.js"></script>

    <!-- Register Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('SW registered:', registration);
                    })
                    .catch((error) => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>